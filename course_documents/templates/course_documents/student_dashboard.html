{% extends 'base.html' %}
{% load static %}

{% block title %}Documentos del Curso - {{ curso.name }}{% endblock %}

{% block extra_css %}
{% endblock %}

{% block content %}
<div class="bg-gradient-to-br from-emerald-500 via-teal-600 to-green-600 text-white py-8 mb-8 transition-all duration-500 ease-out">
    <div class="max-w-7xl mx-auto px-6">
        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6">
            <div class="flex-1">
                <h1 class="text-3xl lg:text-4xl font-bold mb-3 flex items-center gap-3 transition-all duration-300">
                    <i class="bi bi-download text-4xl transition-transform duration-300 hover:scale-110"></i>
                    Documentos del Curso
                    {% if stats.has_new_content %}
                        <span class="inline-flex items-center gap-1 px-3 py-1.5 bg-gradient-to-r from-red-500 to-orange-500 text-white text-sm font-semibold rounded-full animate-pulse transition-all duration-300 hover:scale-105">
                            <i class="bi bi-star-fill"></i>
                            Nuevo
                        </span>
                    {% endif %}
                </h1>
                <p class="text-xl mb-2 font-medium">{{ curso.name }}</p>
                <p class="text-white/80 text-sm">Accede a los materiales y documentos compartidos por tu profesor</p>
            </div>
            <div class="lg:w-auto">
                <a href="{% url 'principal:profile' %}" class="inline-flex items-center gap-2 px-6 py-3 bg-white/20 hover:bg-white/30 backdrop-blur-sm text-white font-medium rounded-lg transition-all duration-300 hover:shadow-lg hover:scale-105 hover:-translate-y-0.5">
                    <i class="bi bi-arrow-left transition-transform duration-300 hover:-translate-x-1"></i>
                    Volver al Perfil
                </a>
            </div>
        </div>
    </div>
</div>

<div class="max-w-7xl mx-auto px-6">
    <!-- Estadísticas -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="bg-white/80 backdrop-blur-sm border border-blue-200/50 rounded-xl shadow-lg p-6 text-center transition-all duration-500 ease-out hover:shadow-2xl hover:bg-white/95 hover:border-blue-300/60 hover:-translate-y-1 hover:scale-[1.02] group">
            <div class="w-16 h-16 mx-auto mb-4 bg-blue-100/80 rounded-full flex items-center justify-center transition-all duration-500 group-hover:bg-blue-200/90 group-hover:scale-110 group-hover:rotate-12">
                <i class="bi bi-folder text-2xl text-blue-600 transition-colors duration-300 group-hover:text-blue-700"></i>
            </div>
            <h3 class="text-3xl font-bold text-gray-800 mb-2 transition-colors duration-300 group-hover:text-gray-900">{{ stats.total_folders }}</h3>
            <p class="text-gray-600 font-medium">Carpetas Disponibles</p>
        </div>
        
        <div class="bg-white/80 backdrop-blur-sm border border-green-200/50 rounded-xl shadow-lg p-6 text-center transition-all duration-500 ease-out hover:shadow-2xl hover:bg-white/95 hover:border-green-300/60 hover:-translate-y-1 hover:scale-[1.02] group">
            <div class="w-16 h-16 mx-auto mb-4 bg-green-100/80 rounded-full flex items-center justify-center transition-all duration-500 group-hover:bg-green-200/90 group-hover:scale-110 group-hover:rotate-12">
                <i class="bi bi-file-earmark-text text-2xl text-green-600 transition-colors duration-300 group-hover:text-green-700"></i>
            </div>
            <h3 class="text-3xl font-bold text-gray-800 mb-2 transition-colors duration-300 group-hover:text-gray-900">{{ stats.total_documents }}</h3>
            <p class="text-gray-600 font-medium">Documentos</p>
        </div>
        
        <div class="bg-white/80 backdrop-blur-sm border border-cyan-200/50 rounded-xl shadow-lg p-6 text-center transition-all duration-500 ease-out hover:shadow-2xl hover:bg-white/95 hover:border-cyan-300/60 hover:-translate-y-1 hover:scale-[1.02] group">
            <div class="w-16 h-16 mx-auto mb-4 bg-cyan-100/80 rounded-full flex items-center justify-center transition-all duration-500 group-hover:bg-cyan-200/90 group-hover:scale-110 group-hover:rotate-12">
                <i class="bi bi-person-badge text-2xl text-cyan-600 transition-colors duration-300 group-hover:text-cyan-700"></i>
            </div>
            <h3 class="text-xl font-bold text-gray-800 mb-2 transition-colors duration-300 group-hover:text-gray-900">{{ curso.teacher.get_full_name|default:curso.teacher.username }}</h3>
            <p class="text-gray-600 font-medium">Profesor</p>
        </div>
    </div>

    <!-- Acciones -->
    <div class="mb-8">
        <div class="flex flex-wrap gap-3">
            <a href="{% url 'course_documents:student_history' curso_id=curso.id %}" class="inline-flex items-center gap-2 px-4 py-2 bg-blue-600/90 hover:bg-blue-700/95 text-white font-medium rounded-lg transition-all duration-300 ease-out hover:shadow-lg hover:scale-110 hover:-translate-y-0.5 backdrop-blur-sm group">
                <i class="bi bi-clock-history transition-transform duration-300 group-hover:scale-110"></i>
                Mi Historial de Descargas
            </a>
        </div>
    </div>

    <!-- Lista de carpetas con documentos -->
    <div class="mb-8">
        <div class="mb-6">
            <h3 class="text-2xl font-bold text-gray-800 mb-2 flex items-center gap-3">
                <div class="w-8 h-8 bg-yellow-100/80 rounded-lg flex items-center justify-center">
                    <i class="bi bi-folder2-open text-yellow-600"></i>
                </div>
                Materiales del Curso
            </h3>
            <div class="h-px bg-gradient-to-r from-yellow-500 via-orange-500 to-transparent"></div>
        </div>
        
        {% if folders %}
            <div class="space-y-6">
                {% for folder in folders %}
                <div class="bg-white/80 backdrop-blur-sm border border-gray-200/50 rounded-xl shadow-lg p-6 transition-all duration-500 ease-out hover:shadow-2xl hover:bg-white/95 hover:border-gray-300/60 hover:-translate-y-1 hover:scale-[1.01] cursor-pointer group folder-card">
                    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-4">
                        <div class="flex-1">
                            <h5 class="text-xl font-semibold text-gray-800 mb-3 flex items-center gap-3 transition-colors duration-300 group-hover:text-gray-900">
                                <div class="w-10 h-10 bg-yellow-100/80 rounded-lg flex items-center justify-center transition-all duration-500 group-hover:bg-yellow-200/90 group-hover:scale-110 group-hover:rotate-12">
                                    <i class="bi bi-folder text-yellow-600 transition-colors duration-300 group-hover:text-yellow-700"></i>
                                </div>
                                {{ folder.name }}
                            </h5>
                            <p class="text-gray-600 font-medium">
                                {{ folder.document_list.count }} documento{{ folder.document_list.count|pluralize }}
                            </p>
                        </div>
                        <div class="lg:w-auto">
                            <a href="{% url 'course_documents:student_folder_detail' curso_id=curso.id folder_id=folder.id %}" 
                               class="inline-flex items-center gap-2 px-4 py-2 bg-blue-600/90 hover:bg-blue-700/95 text-white font-medium rounded-lg transition-all duration-300 ease-out hover:shadow-lg hover:scale-110 hover:-translate-y-0.5 backdrop-blur-sm group/btn">
                                <i class="bi bi-eye transition-transform duration-300 group-hover/btn:scale-110"></i>
                                Ver Documentos
                            </a>
                        </div>
                    </div>
                    
                    <!-- Vista previa de documentos -->
                    {% if folder.document_list %}
                        <div class="border-t border-gray-200/50 pt-4">
                            <h6 class="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2">
                                <i class="bi bi-files text-blue-600"></i>
                                Documentos en esta carpeta:
                            </h6>
                            <div class="space-y-3">
                                {% for document in folder.document_list|slice:":3" %}
                                    <div class="bg-gradient-to-r from-gray-50/60 to-white/60 backdrop-blur-sm border border-gray-200/30 rounded-lg p-4 transition-all duration-300 hover:shadow-md hover:border-gray-300/50 hover:from-gray-50/80 hover:to-white/80 hover:-translate-y-0.5 hover:scale-[1.01] group/doc">
                                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
                                            <div class="flex-1">
                                                <div class="flex items-center gap-2 mb-2">
                                                    <i class="bi bi-file-earmark-text text-blue-600"></i>
                                                    <strong class="text-gray-800 transition-colors duration-300 group-hover/doc:text-gray-900">{{ document.name }}</strong>
                                                </div>
                                                <div class="flex flex-wrap items-center gap-4 text-sm text-gray-600">
                                                    <span class="flex items-center gap-1">
                                                        <i class="bi bi-calendar3"></i>
                                                        {{ document.uploaded_at|date:"d/m/Y H:i" }}
                                                    </span>
                                                    <span class="flex items-center gap-1">
                                                        <i class="bi bi-hdd"></i>
                                                        {{ document.file_size|filesizeformat }}
                                                    </span>
                                                </div>
                                            </div>
                                            <a href="{% url 'course_documents:download_document' curso_id=curso.id document_id=document.id %}" 
                                               class="inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-600/90 to-indigo-600/90 hover:from-purple-700/95 hover:to-indigo-700/95 text-white text-sm font-medium rounded-lg transition-all duration-300 ease-out hover:shadow-lg hover:scale-110 hover:-translate-y-0.5 backdrop-blur-sm group/download">
                                                <i class="bi bi-download transition-transform duration-300 group-hover/download:scale-110"></i>
                                                Descargar
                                            </a>
                                        </div>
                                    </div>
                                {% endfor %}
                                
                                {% if folder.document_list.count > 3 %}
                                    <div class="text-center pt-2">
                                        <a href="{% url 'course_documents:student_folder_detail' curso_id=curso.id folder_id=folder.id %}" 
                                           class="inline-flex items-center gap-2 px-4 py-2 bg-gray-100/80 hover:bg-gray-200/90 text-gray-700 hover:text-gray-900 text-sm font-medium rounded-lg transition-all duration-300 hover:shadow-md hover:scale-105 backdrop-blur-sm">
                                            Ver {{ folder.document_list.count|add:"-3" }} documento{{ folder.document_list.count|add:"-3"|pluralize }} más
                                            <i class="bi bi-arrow-right transition-transform duration-300 hover:translate-x-1"></i>
                                        </a>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center py-16 transition-all duration-500 ease-out">
                <div class="w-24 h-24 mx-auto mb-6 bg-gray-100/80 rounded-full flex items-center justify-center transition-all duration-500 hover:bg-gray-200/80 hover:scale-110 hover:rotate-12">
                    <i class="bi bi-folder2-open text-4xl text-gray-400 transition-colors duration-300"></i>
                </div>
                <h4 class="text-2xl font-bold text-gray-800 mb-4 transition-colors duration-300 hover:text-gray-900">No hay documentos disponibles</h4>
                <p class="text-gray-600 text-lg mb-4">Tu profesor aún no ha compartido documentos para este curso.</p>
                <div class="bg-blue-50/50 rounded-lg px-6 py-4 border border-blue-200/30 inline-block transition-all duration-300 hover:bg-blue-50/70 hover:border-blue-300/50">
                    <p class="text-blue-700 flex items-center gap-2">
                        <i class="bi bi-info-circle"></i>
                        Recibirás una notificación por email cuando se suban nuevos materiales.
                    </p>
                </div>
            </div>
        {% endif %}
    </div>

    <!-- Información adicional -->
    {% if folders %}
    <div class="mt-8">
        <div class="bg-blue-50/50 backdrop-blur-sm border border-blue-200/30 rounded-xl p-6 transition-all duration-300 hover:bg-blue-50/70 hover:border-blue-300/50 hover:shadow-md">
            <div class="flex items-start gap-3">
                <div class="w-8 h-8 bg-blue-100/80 rounded-lg flex items-center justify-center flex-shrink-0 transition-all duration-300 hover:bg-blue-200/90 hover:scale-110">
                    <i class="bi bi-info-circle text-blue-600"></i>
                </div>
                <div>
                    <h4 class="font-semibold text-blue-800 mb-2">Información:</h4>
                    <p class="text-blue-700">
                        Recibirás notificaciones por email cada vez que tu profesor suba nuevos documentos. 
                        Los documentos se organizan en carpetas para facilitar su búsqueda.
                    </p>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Agregar efecto de clic a las tarjetas de carpetas
    document.querySelectorAll('.folder-card').forEach(card => {
        card.addEventListener('click', function(e) {
            // Solo si no se hizo clic en un botón o enlace
            if (!e.target.closest('a, button')) {
                const folderLink = this.querySelector('a[href*="folder"]');
                if (folderLink) {
                    window.location.href = folderLink.href;
                }
            }
        });
    });
    
    // Agregar confirmación para descargas
    document.querySelectorAll('a[href*="download"]').forEach(link => {
        link.addEventListener('click', function(e) {
            const documentName = this.closest('.group\\/doc').querySelector('strong').textContent;
            
            // Mostrar indicador de descarga
            const originalText = this.innerHTML;
            this.innerHTML = '<i class="bi bi-arrow-clockwise animate-spin"></i> Descargando...';
            this.classList.add('pointer-events-none', 'opacity-75');
            
            // Restaurar después de un tiempo
            setTimeout(() => {
                this.innerHTML = originalText;
                this.classList.remove('pointer-events-none', 'opacity-75');
            }, 2000);
        });
    });
});
</script>
{% endblock %}